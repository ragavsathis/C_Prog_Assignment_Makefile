name: Buffer Test CI #change

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build_test:
    name: Build and execute the test binary
    runs-on: ubuntu-latest
    if: ${{ github.event_name == 'pull_request' }}
    steps:
      - name: Checkout
        uses: actions/checkout@v2.3.4
      - name: Build the test binary
        run: make build_test
      - name: Execute the testcases
        run: make execute_test
  release:
    name: Release the test binary in zip file format
    runs-on: ubuntu-latest
    if: ${{ github.event_name == 'push' }}
    steps:
      - name: Checkout
        uses: actions/checkout@v2.3.4
      - name: Install the needed utils
        run: |
          sudo apt-get install zip
          sudo apt-get install build-essential
      - name: Build the test binary
        run: make build_test
      - name: Execute the testcases
        run: make execute_test
      - name: create executable in zip
        run: |
          zip buffer_test.zip buffer_test.out
      - name: Create Release
        uses: marvinpinto/action-automatic-releases@v1.1.1
        with:
          repo_token: ${{ secrets.GITHUB_TOKEN }}
          automatic_release_tag: latest
          prerelease: true
          title: Latest Buffer test Binary
          files: buffer_test.zip